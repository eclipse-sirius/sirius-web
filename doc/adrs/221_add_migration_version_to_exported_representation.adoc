= ADR-221 - Add migration version to exported representation

== Context

When importing a representation, we assign it the version of the newest migration participant for the current migration.
Therefore, we cannot migrate a representation when new participants have been added to Sirius Web after exporting it.

== Decision

=== Backend

We must keep track of the latest migration version applied on the representation.
Such a metadata can be directly stored inside the exported `manifest.json`:

[source,json]
----
{
  "representations": {
    "<representationId>": {
      "latestMigrationPerformed": "<migrationName>",
      "migrationVersion": "<version>"
    }
  }
}
----

=== Import

The migration data will be read from the manifest through a new method `RepresentationProjectContentImportParticipant#getRepresentationImportMetadata`.
A new record `RepresentationImportMetadata` will be created to hold this data (descriptionUri, targetObjectUri, lastMigrationPerformed, migrationVersion).
If the migration data does not exist in the manifest, `"none"` and `"0"` will be used as default values to apply all migration participants over the representation.

The import process will be split into two phases:
1. Unserialization and migration: A new event handler `UnserializeImportedRepresentationDataEventHandler` will handle the unserialization of the representation content and apply migrations through `IRepresentationContentMigrationService#getMigratedContent`.
2. Representation creation: The migrated content will then be used to create the representation through the standard creation flow.

The representation data will be stored as a `String` in `RepresentationSerializedImportData` instead of a deserialized `IRepresentation` to allow migration before full deserialization.

=== Export

`ProjectRepresentationDataExportParticipant#exportData` will be updated to write the migration data (`migrationVersion` and `latestMigrationPerformed`) from the `RepresentationContent` domain object into the representation manifest.

== Consequences

- Representation metadata in the exported JSON manifest will have two new keys `migrationVersion` and `latestMigrationPerformed`.
We will keep support for JSON without such fields to avoid breaking changes at this level.
- `IRepresentationContentMigrationService#getMigratedContent` signature will be changed: it will now take individual parameters (`String representationContent, String kind, String lastMigrationPerformed, String migrationVersion`) instead of domain objects (`RepresentationMetadata representationMetadata, RepresentationContent representationContent`).


== Cutting backs

/

== Status

Accepted.
